# Function and Lambda
## Function as a First Class Object
関数とは，「何かのインプットを与えると，何かのアウトプットを返すもの」と定義されます． (別に特別なことは言っていない)  
みなさんも一度は聞いたことがあろう「関数型言語」は，組み込みデータの一種として関数を扱うことが出来るようになっている．  
第一級オブジェクトとは，実行時に生成したり，受け渡したり，戻り値として返すことを行えるデータ型の事を言う．普通の `Integer` とか `String` とか `List` はみんな第一級．  
難しく言うと，「関数型言語は，関数を第一級オブジェクトとして扱うことが出来るようになっている」ということが出来る．  
関数が第一級オブジェクトとして扱う事ができるようになると， Map-Reduce 理論のようなビッグデータの扱いをすることが可能になる．  
Java8 では，組み込みのデータ型 (プリミティブ型) に関数を新しく定義するのではなく，新たに 「関数インターフェイス」を定義することで，関数を第一級オブジェクトとして扱うことが標準で可能になった．  

## `@FunctionalInterface`
「関数インターフェイス」とは，「実装するべきメソッドが 1 つしかない Interface」のこと．  
`@FunctionalInterface` アノテーションを付してそのことを明示する． (付さなくても関数インターフェイスの要件を満たしていれば大丈夫)  
→ `PlayerNumberResolver.java` を参照．

### 脇道にそれるけど，インターフェイスのデフォルト実装
出てきてしまったので先に紹介しますが， Java8 では Interface にデフォルト実装を書けるようになりました．地味に嬉しい…!!  
`java.util.Function` のソースを読んで，確認してみましょう．
(デフォルトメソッド実装はまたあとで扱います．)

## Lambda Expression
Java8 で追加された, 関数インターフェイスの実装・インスタンスを簡便に表現するための記法．  
ラムダ式そのままで関数が保持されているのではなく，内部的に関数オブジェクトのインスタンスが生成されている．  
→ `LambdaDemo.java`, `VariousLambda.java` を参照．

## ラムダの書き方あれこれ
ラムダの書き方はいくつかあります．

1. 一番の基本形．
```
(int a, int b) -> { 
      if (a > b) {
        return a;
      } else {
        return b;
      }
   }
```
1. `(a, b) -> (a > b ? a : b)`
 * 引数は型推論を行ってくれます．
 * 処理部分が1行の場合はブロック不要．
1. `a -> a * 1000`
 * 引数がひとつの場合は括弧を省略可能．
 * 実は矢印の後ろにある処理の記述も括弧不要．
1. `() -> 1080`
 * `Supplier` とか `Runnable` の場合はこう書きます．
1. `Integer::max`
 * *メソッド参照*という書き方です．

## Lambda の利点とか
Lambda だと何が嬉しいの？無名内部クラスじゃダメなの？  
→ 「読みやすい！」「スッキリする」以外にも，Ikezoe, 2014[1] によると，以下の点で優れているらしい．(本家未確認)

* 匿名内部クラスでは必ず円クロージングインスタンスへの参照を保持するが，ラムダ式は不要な参照は持たない．
* 内部クラスはコンパイル時にクラスが生成されるが，ラムダ式は実行時にクラスが生成される．クラスロードの時間が減るかも？
* インスタンス生成時に，内部クラスは必ず new するが，ラムダ式は JVM が最適な生成方法を選択する．

* 参考文献
 * [1] http://dev.ariel-networks.com/wp/archives/4207 (Ikezoe, 2014)
 * [2] http://d.hatena.ne.jp/nowokay/20130824 (Kishida, 2013)
